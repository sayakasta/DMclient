<projectcomponents xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" project="ProducerOne" xsi:noNamespaceSchemaLocation="../../schemas/components_XSD.xsd">
  <component metaobject="noteuid_list;task_lku;agency_tasks;agency_callreport;call_objective_lku;" name="agencyCallReportDetails" 
  	stackdisplayname="Relationship MGMT Call Reports" displayname="Call Reports Listing">
   
    <action deltaind="M" name="download">
      <workflow deltaind="M" name="download" seq="0">
        <databaseoperation deltaind="M" executionsequence="1" metaobject="agency_callreport" name="getagencycallreport" operation="3" sqlstmt="select (select cast(STUFF((SELECT distinct  ','+call_objective_desc FROM call_objective_lku where  call_objective_id in(select items from dbo.Split(acr.call_objective_ids,','))        FOR XML PATH('')) , 1, 1, '') as varchar(8000)) ) as call_objective,CONCAT(am.agency_id,'-',am.name)as location_name,acr.agencycallreport_id,acr.agency_id,acr.field_rep,acr.date_time,acr.venue,acr.call_purpose,acr.comments,acr.action_items,acr.addtional_attendees,acr.chair_person,results_of_call = convert(varchar(8000), acr.results_of_call),acr.competitive_intelligence,acr.last_updated_by,acr.last_updated_ts,acr.call_status,acr.business_segment_code,acr.call_type,acr.visit_duration,acr.questions_tobeasked,topics_discussed = convert(varchar(8000), acr.topics_discussed),acr.followup_needed,acr.location,acr.Operating_division_id,acr.report_document_by,acr.location_description,acr.purpose_of_call_desc as purpose_of_call_other_desc,acr.callreporttype_id,acr.creation_date,acr.agency_quoting,acr.agency_training,acr.value_added,acr.changes_in_agency,acr.risk_name,acr.quotenumber,acr.approved,acr.products,acr.other_call_objective,acr.call_objective_ids,acr.contact_name,convert(varchar(8000),acr.additional_comments) as additional_comments,acr.zone_code,case when acr.zone_code is null or acr.zone_code ='' then 'NULL' else (select zone_desc from zones_lku zlk where zlk.zone_code = acr.zone_code) end as zone_desc,acr.market_rep_id,acr.fax,acr.physicaladdress,(select business_segment_name from business_segment where business_segment_code=acr.business_segment_code) as business_segment_name, (CASE WHEN call_type = 1 THEN 'Physical Visit' ELSE CASE WHEN call_type=2 THEN 'Phone Call' ELSE CASE WHEN call_type=3 THEN 'Email' END END END) as call_type_desc, (CASE WHEN call_status =1 THEN 'Not Started' ELSE CASE WHEN call_status =2 THEN 'In Progress' ELSE CASE WHEN call_status =3 THEN 'Complete' END END END) as call_status_desc, (select name from agency_master where agency_id=acr.location) as location_desc,(select name from agency_master where agency_id=acr.agency_id) as name_desc,od.Operating_division_description, pcl.purpose_of_call_desc as purpose_of_call_description,ml.market_rep_desc  ,cast(STUFF((SELECT distinct  ', '+call_objective_desc  FROM call_objective_lku  where  call_objective_id in(  select items   from dbo.Split(acr.call_objective_ids,','))FOR XML PATH('')  ) , 1, 1, ''  ) as varchar(8000))  as call_objectives_desc, (Select f32 from configurationclient.html_extendedfields_mapping_data  where object_id=acr.agency_id and f32 is Not Null)as addAgencyCallReportDetails_followup_date   from agency_callreport acr                                 LEFT JOIN operating_division od WITH(NOLOCK) ON od.Operating_division_id = acr.Operating_division_id                              LEFT JOIN purpose_of_call_lku pcl WITH(NOLOCK) ON pcl.purpose_of_call_id = acr.call_purpose                               LEFT JOIN market_rep_lku ml WITH(NOLOCK) ON ml.market_rep_id = acr.market_rep_id LEFT JOIN agency_master am WITH(NOLOCK) ON am.agency_id = acr.agency_id                             where agencycallreport_id=#object_id#" />
        </workflow>
    </action>
    
  </component>
</projectcomponents>
